# 运行时数据区

## 结构

![image-20211207230130777](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211207230130777.png)

![image-20211207230931059](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211207230931059.png)

> java 虚拟机定义了若干程序运行的期间会使用到的运行时数据区，其中有一些会随着虚拟机的启动二创建，随着虚拟机的退出而销毁，另外一些则是与线程一一对应，这些与线程对应的数据区域会随着线程的开始和结束二创建和销毁。
>
> 灰色的为单独线程私有的，红色为多个线程共享的，即
>
> 1. 每个线程：独立包括程序计数器、栈、本地栈。
> 2. 线程间共享：堆、堆外内存（永久代或者元空间、代码缓存）

## JVM系统线程

![image-20211208211324434](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211208211324434.png)

## 程序计数器（PC寄存器）

### 介绍：



![image-20211208211824315](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211208211824315.png)

**![image-20211208212032807](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211208212032807.png)**

![image-20211208212148482](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211208212148482.png)

![image-20211208213115921](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211208213115921.png)

![image-20211208213230535](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211208213230535.png)

## 虚拟机栈

### 虚拟机栈概述

#### 背景：

![image-20211208214458434](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211208214458434.png)

![](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211208214628887.png)

![image-20211208215021500](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211208215021500.png)

![image-20211208215719927](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211208215719927.png)

![image-20211208220055616](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211208220055616.png)

![image-20211208220259435](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211208220259435.png)

### 栈的存储单位

![image-20211211125454222](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211211125454222.png)

![image-20211211125749725](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211211125749725.png)

![image-20211211130456732](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211211130456732.png)

![image-20211211132030264](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211211132030264.png)

![image-20211212092810667](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211212092810667.png)

![image-20211212095524606](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211212095524606.png)

![image-20211212100418953](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211212100418953.png)

![image-20211212100609277](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211212100609277.png)

![image-20211212101106872](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211212101106872.png)

![image-20211212100959892](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211212100959892.png)

### 局部变量表

![image-20211211132721423](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211211132721423.png)

![](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211211134758891.png)

### 操作数栈

![image-20211212101436461](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211212101436461.png)

![image-20211212101723419](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211212101723419.png)

![image-20211212101743265](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211212101743265.png)

![image-20211212102115539](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211212102115539.png)

### 代码追踪

![image-20211212102205006](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211212102205006.png)

![image-20211212153317730](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211212153317730.png)

![image-20211212170836815](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211212170836815.png)





### 栈顶缓存技术

![image-20211212171442063](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211212171442063.png)

### 动态链接

![image-20211212171954435](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211212173405400.png)



### 方法的调用：解析与分派

![image-20211212173728400](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211212173728400.png)

![image-20211212173826338](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211212173826338.png)

![image-20211212174428567](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211212174428567.png)



![image-20211213195436029](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213195436029.png)

![image-20211213195554312](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213195554312.png)**![image-20211213194228465](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213194228465.png)**![image-20211213194505039](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213194505039.png)

![image-20211213200258536](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213200258536.png)

![image-20211213200521376](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213200521376.png)

![image-20211213210939003](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213210939003.png)

### 方法返回地址（return address）

![image-20211213211052455](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213211052455.png)

![image-20211213211125629](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213211125629.png)

![image-20211213211524069](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213211524069.png)

![image-20211213212004695](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213212004695.png)

![image-20211213212206899](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213212206899.png)

### 一些附加信息



### 栈的相关试题

## 本地方法接口

![image-20211213214423828](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213214423828.png)

![image-20211213214441916](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213214441916.png)

![image-20211213214652762](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213214652762.png)

![image-20211213214844983](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213214844983.png)

![image-20211213215228023](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213215228023.png)

## 本地方法栈

![image-20211213215651451](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213215651451.png)

![image-20211213215938284](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211213215938284.png)

##  堆

### 堆的核心概念

![image-20211214221616745](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211214221616745.png)

![image-20211215204651240](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211215204651240.png)

![image-20211215205127901](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211215205127901.png)

![image-20211215205753493](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211215205753493.png)



```
VM options: 
-XX:+PrintGCDetails
```



### 设置堆内存大小与OOM

![image-20211215210928086](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211215210928086.png)

![image-20211215212150350](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211215212150350.png)

![image-20211215212759552](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211215212759552.png)

### 年轻代和老年代

![image-20211215213419509](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211215213419509.png)

![image-20211215213708146](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211215213708146.png)

![image-20211215214038936](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211215214038936.png)

![image-20211215214724909](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211215214724909.png)

### 图解对象分配过程

![image-20211215214809046](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211215214809046.png)

![image-20211215215001350](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211215215001350.png)

![image-20211215215132866](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211215215132866.png)

![image-20211215215437452](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211215215437452.png)

![image-20211215215824596](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211215215824596.png)

![image-20211215220115501](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211215220115501.png)

![image-20211215220356113](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211215220356113.png)

![image-20211215221448112](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20211215221448112.png)

### MinorGC、MajorGC、 FullGC

### 堆空间的分代思想

### 内存分配策略

### 为对象分配内存：TLAB

### 小结堆空间的参数配置

### 堆时分配对象的唯一选择吗



### 