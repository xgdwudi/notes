# web开发中如何认证和授权

## 在配置文件来设置用户名密码

​	![image-20210621221843805](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20210621221843805.png)

## 通过配置类完成用户名密码设置：



![image-20210621222535917](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20210621222535917.png)

## 自定义实现类（常用方法）：

![image-20210621223001437](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20210621223001437.png)

```java
@Configuration
public class SericutyConfig extends WebSecurityConfigurerAdapter {

    @Autowired
    private UserDetailsService userDetailsService;

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
       auth.userDetailsService(userDetailsService).passwordEncoder(passwordEncoder());
    }

    @Bean
    PasswordEncoder passwordEncoder(){
        return new BCryptPasswordEncoder();
    }
}
```

```java
@Service("userDetailsService")
public class MyUserDetilService implements UserDetailsService {
    @Override
    public UserDetails loadUserByUsername(String s) throws UsernameNotFoundException {
        List<GrantedAuthority> admin =
                AuthorityUtils.commaSeparatedStringToAuthorityList("admin");
        return new User("user",
                new BCryptPasswordEncoder().encode("123"),admin);
    }
}
```

## 连接数据配置

```java
@Service("userDetailsService")
public class MyUserDetilService implements UserDetailsService {

    @Autowired
    private UserMapper userMapper;
    @Override
    public UserDetails loadUserByUsername(String phone) throws UsernameNotFoundException {
        //调用userMapper方法查询数据库
        QueryWrapper<Users> wrapper = new QueryWrapper<>();
        wrapper.eq("phone",phone);
        Users users = userMapper.selectOne(wrapper);
//        判断
        if(users==null){
            throw new UsernameNotFoundException("用户不存在！！");
        }
        List<GrantedAuthority> admin =
                AuthorityUtils.commaSeparatedStringToAuthorityList("admin");
//        从数据库返回user对象，得到用户名和密码
        return new User(users.getPhone(),
                new BCryptPasswordEncoder().encode(users.getPassword()),admin);
    }
}
```

https://www.bilibili.com/video/BV15a411A7kP?p=11&spm_id_from=pageDriver

## 自定义登陆页面：

![image-20210622231756452](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20210622231756452.png)

## 基于角色权限进行访问控制：

### hasAuthority方法

![image-20210622232541524](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20210622232541524.png)

1. 修改配置类

![image-20210622232658646](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20210622232658646.png)

![image-20210622232757737](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20210622232757737.png)

## hasAnyAuthority方法

![image-20210622233041337](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20210622233041337.png)

![image-20210622233337514](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20210622233337514.png)

## hasRole 方法

![image-20210622233735433](https://gitee.com/xu_guo_dong/images/raw/master/img/image-20210622233735433.png)

## hasAnyRole 方法